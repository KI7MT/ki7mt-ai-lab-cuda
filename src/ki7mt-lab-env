#!/bin/bash
# ==============================================================================
# Name..........: ki7mt-lab-env
# Version.......: @VERSION@
# Purpose.......: Standardized Environment Variables for the AI Lab
# Usage.........: source /usr/bin/ki7mt-lab-env
# ==============================================================================
#
# OVERRIDE PRIORITY (highest to lowest):
#   1. Pre-existing environment variables (user-set)
#   2. Built-in defaults
#
# RAID-0 NVMe Configuration:
#   The default ClickHouse data path is /mnt/ai-stack/clickhouse for
#   optimal performance on RAID-0 NVMe arrays. Override via environment:
#
#   export CLICKHOUSE_DATA_DIR=/custom/path
#   source /usr/bin/ki7mt-lab-env
#
# ==============================================================================

PROGRAM="@PROGRAM@"
VERSION="@VERSION@"

# ==============================================================================
# 1. CLICKHOUSE CONNECTION
# ==============================================================================
export CLICKHOUSE_HOST="${CLICKHOUSE_HOST:-localhost}"
export CLICKHOUSE_PORT="${CLICKHOUSE_PORT:-9000}"
export CLICKHOUSE_USER="${CLICKHOUSE_USER:-default}"
export CLICKHOUSE_PASSWORD="${CLICKHOUSE_PASSWORD:-}"
export CLICKHOUSE_DB="${CLICKHOUSE_DB:-wspr}"

# ==============================================================================
# 2. STORAGE PATHS (RAID-0 NVMe Optimized)
# ==============================================================================
export WSPR_DATA_DIR="${WSPR_DATA_DIR:-/mnt/ai-stack/wspr-data}"
export SOLAR_DATA_DIR="${SOLAR_DATA_DIR:-/mnt/ai-stack/solar-data}"
export CLICKHOUSE_DATA_DIR="${CLICKHOUSE_DATA_DIR:-/mnt/ai-stack/clickhouse}"

# Sub-directories (derived from base paths)
export WSPR_RAW_DIR="${WSPR_DATA_DIR}/raw"
export WSPR_DOWNLOAD_DIR="${WSPR_DATA_DIR}/downloads"
export SOLAR_RAW_DIR="${SOLAR_DATA_DIR}/raw"

# ==============================================================================
# 3. APPLICATION PATHS (FHS-Compliant)
# ==============================================================================
export DDL_PATH="/usr/share/${PROGRAM}/ddl"
export LAB_LOG_DIR="${LAB_LOG_DIR:-/var/log/${PROGRAM}}"
export LAB_CONF_DIR="${LAB_CONF_DIR:-/etc/${PROGRAM}}"

# ==============================================================================
# 4. PERFORMANCE TUNING (Optional Overrides)
# ==============================================================================
export INGEST_RAM_GB="${INGEST_RAM_GB:-64}"
export INGEST_WORKERS="${INGEST_WORKERS:-16}"
export INGEST_BATCH_SIZE="${INGEST_BATCH_SIZE:-100000}"

# ==============================================================================
# INTERACTIVE SHELL MESSAGE
# ==============================================================================
if [[ $- == *i* ]]; then
    printf "KI7MT AI Lab Environment (${VERSION}) Loaded.\n"
    printf "  WSPR Data.......: %s\n" "$WSPR_DATA_DIR"
    printf "  Solar Data......: %s\n" "$SOLAR_DATA_DIR"
    printf "  ClickHouse Data.: %s\n" "$CLICKHOUSE_DATA_DIR"
    printf "  ClickHouse Host.: %s:%s\n" "$CLICKHOUSE_HOST" "$CLICKHOUSE_PORT"
fi
